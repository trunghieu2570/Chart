language: android
sudo: required
jdk: oraclejdk8
before_cache:
  - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
env:
  global:
    - ANDROID_API=29
    - EMULATOR_API=24
    - ANDROID_BUILD_TOOLS=29.0.2
    - ADB_INSTALL_TIMEOUT=5
    - secure: T4hJ9q81qQwKB+aRSJdojCTCvX4QQA8UCbAfTT/QHfAcyMdBXwV3YGPO0RU7cAhXJ+NWcTSEJnHvwMsq82KMJx0PdppQlVKNGK2kBzKmH/vmKjJgW6zHeDeqajCR+VmciajT3PUOQDEfXkd/efI1dCgWFGFQ8WJZTgrtjhcGPpfYNSoDBt+E/90nLGKN+Gp6S31+LZhy/fshzbG8bN0aGz3GOaN+JwoseK37YX3gWlWIlEGp7Ah4aDdj1+S5Mi/hcyeVVBJQShuYeWukCRFplLKtYczTCCWxuNgzV+Px5YKYlsnfnChyaTqYBU7djoIbG1o7pVmgChLvyP4YK7CD0pin5Ege8XnwcyFM7SUSo+LXpf7C2wdAk3YdLAAxTzrc+AvcN9SLlVWycETIwC5ONsPIoGFjzOZ/gpgRsC5KG3gSgKCI474VNd3CoNLhIOEltp0tyTQ0fpPRxuIlyY3sPOWO/5EJwGxmRFcJ/Zrvg8B8UKQWHb35/ADMJTaxNnOlvgZT1Ijd+Z9P7B2g+1O7aS43JcrwZXHGWlY8oFofQ6cvOzQONx1/mcbvDP7NVxTDGlwBziUsNrQuHANOZITXSaz8SmwLnYjloshdgH7gkTZIbgWeLnGvyJP81sXfeeY8FUI6mrLzn7lXvmW/cGPEGJo4RyYoav+9E9TaRLfIUuU=
    - secure: hC6HgoSfI3dG0ugLH8z7pgttl/ydcKLMriCMcD5CwG9ujntuJWaJOdQ1mGUc6NpcFA1ofqGULf+w6kxmACMwsnbjQGuMaIWRTRQZPzjZKg8yuC8dvTDF9B9+C9+YdUMXV0E0GfeE9tpyepg8o8XNIwIXv6HsLw8kaVGA72/KrwLKBi3DpS4G9DFVzJ5wrHBAJVm62n8i51uCzqqvb8qO3W//TLswG2ZVVXbCx9X8DaixEuLpkqfree+6SlLFo8STNIuMPqzUMh2bw7xqBngDu3FEC9bGyJdErO0gAVvpaHuazxeC+PQqgZRnzal1AhOKRvuBPBUROvmRazCaKFkeZxeOuBLeMb88hyw0Te4Vm3utKjpEoCOKHZZlzbMiBVZQs6WFzKaUkM0hWSxEDQ7jnIw/wIfWuvG6ug2CY2I0FYxSp8S4BMfxVEz6i/qPqe6rwg4/OZwD8B+WRflETsftZrpU6wgP1PQ2rL3O3+OVfKpOllalivv3u9JwzxvQRDp3UGaeaGIZveDvd5hGBMFXjDwEhM1lX5Rl64OJcjdJJgA551Clok9tkXONIwLsDcPRQKhR2W2eJCwQEKLAUTZOYXfiunuVgHyEgBZnaHuO8KaF+NGUhm+7plj8lPz3efhpHMDvHkXD/n/kk4nxgBYOPUgtdqDBwbnHMxS461DXXI4=
android:
  components:
    - tools
    - platform-tools
    - build-tools-$ANDROID_BUILD_TOOLS
    - android-$ANDROID_API
    - android-$EMULATOR_API
    - extra-google-m2repository
    - extra-android-m2repository
    - addon-google_apis-google-19
    - sys-img-armeabi-v7a-android-$ANDROID_API
    - sys-img-armeabi-v7a-android-$EMULATOR_API
  licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+
before_install:
  - openssl aes-256-cbc -K $encrypted_0de4f5174111_key -iv $encrypted_0de4f5174111_iv -in keystore.jks.enc -out keystore.jks -d
  - mkdir "$ANDROID_HOME/licenses" || true
  - echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
  - echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
  - chmod +x gradlew
  - "./gradlew dependencies || true"
#before_script:
#  - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a
#  - emulator -avd test -no-skin -no-audio -no-window &
#  - android-wait-for-emulator
#  - adb shell input keyevent 82 &
script:
#  - "./gradlew clean build connectedCheck -PdisablePreDex --stacktrace"
  - "./gradlew clean build"
before_deploy:
  - cp $TRAVIS_BUILD_DIR/keystore.jks $HOME
  - cd app/build/outputs/apk/
  - jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/keystore.jks -storepass $storepass -keypass $keypass app-release-unsigned.apk key0
  - jarsigner -verify app-release-unsigned.apk
  - "${ANDROID_HOME}/build-tools/29.0.2/zipalign -v 4 app-release-unsigned.apk Chart.apk"
deploy:
  provider: releases
  file: Chart.apk
  skip_cleanup: true
  on:
    repo: trunghieu2570/Chart
    tags: true
    jdk: oraclejdk8
  api_key:
    secure: "wzvr57/vbse56E47pYZ3rUYHPrTz144bT/RVDxEVJlD4SJ0KTjNxQx6dXCryjQXvv3EcraFnnIgXExwhaIxgQJpu5ezHhCn1+RO3tx14JMsBKN3UICmFIH8VuCqztSYdj6KOZWhMfOi9KBI6TbIyEZRgh/nDa93m5Z/4eYeNMGw8b4tdLRxR8owORl4YOPVRpp8lu/7zZVjUCaOQlKhkCcqar1s7hecdqBEsePhr6Abp/teIWMazrFnrxZ+akCyCk8te3J24Ca84D3KJg89+8LhvnkvYQAp7PfL5uqWj9hdlYhoirVnp237qS6NjiWrWd/W6FojK9zXYxNfG/VCGHmcWNQMCY/m6QQZ1KsDiDxrFWZTiRGZCkeZhuvy0F7e9Om/lstnY19hhOPq+0MhBPZmfozOdRGFyk2dZmotOPwtyIh9JTAQOPEh3zZ55YNyIq/UX3NOod6y9fnSd3DNsLNeuOh1G3rtcbLdtCk8fBDpELO01ydzDXKGa8OcOf61GJHIQEbdoEw0st+lChk1hxNwafEaGT6wibvDaGXWOFTWjIQEyc2PjCRMofKjCx+hGbPSovC1vk2zDLogtfV8jEmf0kV9YgpjrP4eqWdgAF+62c6mxJfIatdOF2nZr/FFNsAyHdP5+ei20VfBbZR9awAywfHQtIyD5QoxcFVWX05U="
